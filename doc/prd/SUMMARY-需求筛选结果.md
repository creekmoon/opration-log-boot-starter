# 操作日志 Starter 需求汇总与筛选结果

**文档类型**：需求分析汇总
**更新时间**：2026-02-27

---

## 一、初版 10 个需求（已淘汰 6 个）

| 编号 | 需求 | 状态 | 淘汰原因 |
|------|------|------|----------|
| 001 | 用户操作频率限流 | ❌ 淘汰 | Sentinel 更成熟 |
| 002 | 操作热力图统计 | ❌ 淘汰 | Micrometer+Grafana 更好 |
| 003 | 用户行为画像 | ❌ 淘汰 | 太重，工具类不该做 |
| 004 | 操作防重复提交 | ❌ 淘汰 | Sentinel 更成熟 |
| 005 | 操作链追踪 | ✅ 保留 | 排查问题刚需 |
| 006 | 敏感操作实时告警 | ❌ 淘汰 | Redis Pub/Sub 不可靠 |
| 007 | 日志缓冲批处理 | ✅ 保留 | 解决 ES 压力真痛点 |
| 008 | 操作日志查询缓存 | ❌ 淘汰 | ES 本身有缓存 |
| 009 | 动态配置开关 | ✅ 合并 | 并入缓冲批处理 |
| 010 | 多租户日志隔离 | ❌ 淘汰 | 架构层解决更好 |

---

## 二、新增 4 个轻量级方向

| 需求 | 状态 | 核心价值 | 依赖 |
|------|------|----------|------|
| MDC 上下文增强 | ✅ 保留 | 日志自动带上下文 | 零依赖 |
| Micrometer 指标 | ✅ 保留 | 接入 Prometheus | Spring 自带 |
| 条件日志 | ✅ 保留 | 减少 90% 无用日志 | 零依赖 |
| 结构化输出 | ✅ 保留 | 对接现代日志系统 | 零依赖 |

---

## 三、最终 4 个核心需求

### 1. 可观测性增强
- MDC 上下文自动注入
- Micrometer 指标输出
- 操作链追踪

### 2. 智能日志
- 条件日志（按规则过滤）
- 结构化 JSON 输出

### 3. 高性能写入
- Redis 缓冲批处理
- 动态采样率配置

### 4. 扩展接口
- 保留现有 Handler 机制
- 支持用户自定义存储

---

## 四、筛选原则

1. **最少依赖**：优先零依赖或 Spring 自带
2. **解决真问题**：ES 压力、排查效率、成本
3. **不重复造轮子**：限流/统计用成熟方案
4. **轻量级**：代码少，配置简单

---

## 五、下一步

为 4 个核心需求撰写详细 PRD，进入开发阶段。
