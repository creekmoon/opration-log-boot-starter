# 实时热力图与用户画像 Dashboard 改进 PRD

## 研究分析

### 一流厂家对标

#### 1. Datadog Dashboard
**优秀设计**:
- 时间轴拖拽缩放
- 图表联动（点击一个图表，其他图表联动过滤）
- 多维度下钻（从服务 → 接口 → 用户）
- 实时/历史模式切换
- 自定义视图布局

**可借鉴**:
- 时间范围选择器
- 图表联动机制
- 多维度钻取

#### 2. Grafana
**优秀设计**:
- 丰富的可视化类型（热力图、桑基图、词云）
- 动态阈值告警
- 变量模板（动态筛选）
- 混合数据源

**可借鉴**:
- 热力图矩阵（接口 × 时间）
- 变量筛选器
- 告警标记

#### 3. 阿里云 ARMS
**优秀设计**:
- 业务拓扑图
- 用户旅程分析
- 多维归因分析
- 智能异常检测

**可借鉴**:
- 接口拓扑关系
- 用户旅程漏斗
- 智能洞察卡片

---

## 改进方案

### 一、数据维度扩展（从4维 → 12维）

#### 新增维度

| 维度 | 说明 | 可视化方式 |
|------|------|-----------|
| 1. 接口响应时间 | P50/P95/P99 分位数 | 折线图 + 热力图 |
| 2. 错误率趋势 | 按接口/时间维度 | 面积图 |
| 3. 用户活跃度 | 日活/周活/月活 | 计数器 + 趋势 |
| 4. 地域分布 | 按省份/城市统计 | 中国地图 |
| 5. 终端分布 | Web/App/小程序 | 饼图 |
| 6. 接口依赖拓扑 | 服务调用关系 | 拓扑图 |
| 7. 用户留存 | 次日/7日/30日留存 | 漏斗图 |
| 8. 操作路径 | 用户行为路径 | 桑基图 |

#### 原有维度增强

| 原维度 | 增强 |
|--------|------|
| PV/UV | 增加独立访客趋势、人均访问次数 |
| TopN | 增加环比增长率、同比对比 |
| 标签分布 | 增加标签组合分析 |
| 操作类型 | 增加操作转化漏斗 |

---

### 二、交互功能增强

#### 1. 时间维度交互
- **时间范围选择**: 快速选择（最近5分钟/1小时/24小时/7天）+ 自定义范围
- **时间拖拽缩放**: 在图表上拖拽选择时间范围，所有图表联动
- **实时/历史切换**: 实时模式（5秒刷新）vs 历史模式

#### 2. 数据钻取
- **下钻路径**: 服务 → 接口 → 用户 → 单次请求
- **上卷返回**: 面包屑导航，一键返回上级
- **交叉筛选**: 点击图表元素，其他图表联动过滤

#### 3. 对比分析
- **时间对比**: 本周 vs 上周，今天 vs 昨天
- **接口对比**: 多接口性能对比
- **用户群对比**: 不同标签用户行为对比

#### 4. 智能洞察
- **异常检测**: 自动标记异常峰值
- **趋势预测**: 基于历史数据预测未来趋势
- **关联分析**: 发现指标间的关联关系

---

### 三、面板-CSV深度联动

#### 1. 一键导出
- 每个图表右上角添加「导出CSV」按钮
- 导出当前筛选条件下的原始数据
- 支持导出当前视图（带筛选、时间范围）

#### 2. 数据同步
- 面板数据与CSV数据同源，确保一致性
- 导出时附带数据说明（时间范围、筛选条件）

#### 3. 批量导出
- 支持导出整个仪表盘为 Excel（多Sheet）
- 支持定时导出（每日/每周报告）

---

### 四、视觉设计升级

#### 设计原则
- **信息密度**: 一屏展示更多关键信息
- **色彩系统**: 专业数据可视化配色
- **动效**: 适度动画，提升体验
- **响应式**: 适配大屏/桌面/平板

#### 具体改进

| 元素 | 当前 | 改进后 |
|------|------|--------|
| 布局 | 固定卡片 | 可拖拽网格布局 |
| 色彩 | 渐变色 | 专业数据色板 |
| 字体 | 默认字体 | 等宽数字 + 无衬线中文 |
| 图表 | Chart.js基础 | ECharts高级可视化 |
| 主题 | 浅色单一 | 浅色/深色/高对比度 |

#### 参考设计
- **主色调**: #1677FF（阿里云蓝）
- **成功色**: #52C41A
- **警告色**: #FAAD14
- **错误色**: #F5222D
- **背景**: #F0F2F5（浅灰）/ #141414（深色）

---

## 技术实现方案

### 前端技术栈
- **框架**: 保持纯HTML+JS，引入 Vue3（可选）
- **图表**: ECharts 5（功能更丰富）
- **UI组件**: 引入 Ant Design Vue 或 Element Plus（可选）
- **地图**: 阿里云 DataV 中国地图

### 后端接口扩展
```java
// 新增接口
GET /operation-log/metrics/response-time  // 响应时间分位数
GET /operation-log/metrics/error-rate     // 错误率
GET /operation-log/metrics/geo-dist       // 地域分布
GET /operation-log/metrics/user-retention // 用户留存
GET /operation-log/metrics/topology       // 接口拓扑
```

### 数据结构优化
```json
{
  "timestamp": "2024-02-28T14:30:00",
  "metrics": {
    "pv": 1000,
    "uv": 500,
    "responseTime": {
      "p50": 45,
      "p95": 120,
      "p99": 200
    },
    "errorRate": 0.02,
    "geo": {
      "北京": 300,
      "上海": 250
    }
  }
}
```

---

## 执行排期

| 阶段 | 时间 | 任务 | 产出 |
|------|------|------|------|
| Phase 1 | 22:00-23:00 | 数据维度扩展 | 8个新维度接口 + 页面 |
| Phase 2 | 23:00-00:00 | 交互功能增强 | 时间选择器、钻取、对比 |
| Phase 3 | 00:00-01:00 | 面板-CSV联动 | 一键导出、批量导出 |
| Phase 4 | 01:00-02:00 | 视觉设计升级 | ECharts + 新主题 |
| Phase 5 | 02:00-03:00 | 集成测试 | 完整功能验证 |

---

## 成功标准

1. **维度**: 从4维提升到12维
2. **交互**: 支持时间缩放、数据钻取、多维度对比
3. **导出**: 每个图表支持一键导出CSV
4. **视觉**: 对标Datadog/Grafana专业度
5. **性能**: 页面加载 < 2秒，实时刷新 < 5秒

---

*PRD版本: v1.0*  
*创建时间: 2026-02-28 22:00*  
*执行人: Kimi Claw*
