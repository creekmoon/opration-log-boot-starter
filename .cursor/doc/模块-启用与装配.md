# 模块-启用与装配

## 0. 模块目标

通过一个注解让业务应用“显式启用” operation-log 组件，并完成切面与默认实现的注册。

## 1. 边界

- **包含**：启用注解、配置类导入、上下文开关 `disable` 的启用
- **不包含**：Spring Boot 自动装配 imports/spring.factories（当前仓库 `src/main/resources` 为空）

## 2. 可检索关键词

EnableOperationLog / OperationLogAutoConfiguration / OperationLogConfig / @Import / @PostConstruct / OperationLogContext.disable / DefaultOperationLogHandler / DefaultOperationLogRecordInitializer

## 3. 已实现能力（DONE）

- **显式启用入口**：业务应用在启动类添加 `@EnableOperationLog` 即可启用（锚点：`cn.creekmoon.operationLog.config.EnableOperationLog`）
- **注册核心 Bean**：启用后会导入并注册 `LogAspect`、默认处理器、默认初始化器（锚点：`cn.creekmoon.operationLog.config.OperationLogAutoConfiguration` 的 `@Import(...)`）
- **开启上下文开关**：启用时通过 `@PostConstruct` 将 `OperationLogContext.disable=false`（锚点：`OperationLogAutoConfiguration#init` + `OperationLogContext.disable`）
- **配置前缀占位**：存在 `@ConfigurationProperties(prefix="operation-log")` 的配置类，但当前无具体字段（锚点：`cn.creekmoon.operationLog.config.OperationLogConfig`）

## 4. 主要入口与关键类（从哪里开始读）

- `cn.creekmoon.operationLog.config.EnableOperationLog`
- `cn.creekmoon.operationLog.config.OperationLogAutoConfiguration`
- `cn.creekmoon.operationLog.config.OperationLogConfig`
- `cn.creekmoon.operationLog.core.OperationLogContext`（`disable` 的默认值与启用时机）

## 5. 核心流程（高层）

1. 启动类加 `@EnableOperationLog`
2. Spring 处理 `@Import({OperationLogConfig.class, OperationLogAutoConfiguration.class})`
3. `OperationLogAutoConfiguration` 导入 `LogAspect` 与默认实现，并在 `@PostConstruct` 中开启 `OperationLogContext.disable=false`

## 6. 外部依赖

- Spring Framework / Spring Boot（提供 `@Import`、`@ConfigurationProperties`、bean 生命周期）

## 7. 模块协作点

- 启用后，`LogAspect` 才会成为 Bean 并生效（协作点：`OperationLogAutoConfiguration @Import LogAspect.class`）

## 8. 常见问题（优先看哪里）

- **为什么加了 `@OperationLog` 不生效**：先看是否添加了 `@EnableOperationLog`（`EnableOperationLog`、`OperationLogAutoConfiguration`）
- **为什么 `OperationLogContext.follow()` 没反应**：先看 `OperationLogContext.disable` 是否被启用（`OperationLogAutoConfiguration#init`）

